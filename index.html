<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARCHITECT PRO | CHESS & LUDO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Roboto+Mono&display=swap');
        :root { --p: #00d4ff; --bg: #0a0e17; --c: #141b26; --sl: #dee3e6; --sd: #769656; --r: #ff4b2b; --g: #00ff87; --b: #00d4ff; --y: #f9d423; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; touch-action: none; }
        
        .architect-tag { font-size: 24px; font-weight: 900; color: var(--p); text-shadow: 0 0 10px var(--p); letter-spacing: 4px; margin-top: 15px; text-transform: uppercase; }
        .credits { font-size: 9px; color: var(--p); letter-spacing: 3px; margin-bottom: 15px; opacity: 0.7; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        /* Chess Styling */
        img.piece { width: 90%; z-index: 5; pointer-events: none; filter: drop-shadow(0 0 2px rgba(255,255,255,0.5)); }
        .black { filter: invert(1) brightness(0.8) drop-shadow(0 0 2px var(--p)) !important; }

        /* General UI */
        .nav-ui { position: fixed; top: 15px; left: 15px; z-index: 110; display: flex; gap: 8px; }
        .btn-ui { background: rgba(0, 212, 255, 0.1); border: 1px solid var(--p); color: var(--p); padding: 8px 12px; border-radius: 8px; font-size: 10px; cursor: pointer; font-weight: bold; }
        .overlay { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; overflow-y: auto; text-align: center; }
        .auth-card { background: var(--c); padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; border: 1px solid #222; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        input, select { background: #000; border: 1px solid var(--p); color: white; padding: 12px; margin: 8px 0; width: 100%; text-align: center; border-radius: 8px; font-family: 'Roboto Mono'; outline: none; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 14px; background: var(--p); color: #000; border: none; border-radius: 8px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; margin-top: 10px; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 90%; }
        .menu-item { background: var(--c); padding: 20px 10px; border-radius: 12px; border: 1px solid #333; cursor: pointer; text-align: center; font-size: 11px; }

        /* Ludo Layout */
        #ludo-board { display: none; width: 92vw; max-width: 400px; aspect-ratio: 1/1; background: #fff; position: relative; border: 4px solid #333; }
        .ludo-grid { display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr); height: 100%; width: 100%; }
        .cell { border: 0.1px solid rgba(0,0,0,0.2); position: relative; display: flex; align-items: center; justify-content: center; }
        .home { width: 100%; height: 100%; }
        .red { background: var(--r); } .green { background: var(--g); } .blue { background: var(--b); } .yellow { background: var(--y); }
        .star::after { content: '‚òÖ'; color: rgba(0,0,0,0.3); font-size: 12px; }
        .token { width: 80%; height: 80%; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.5); z-index: 10; position: absolute; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .dice-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: #222; border: 2px solid var(--p); border-radius: 10px; color: var(--p); font-size: 24px; display: flex; align-items: center; justify-content: center; z-index: 20; cursor: pointer; }
        
        /* Chess Board */
        #board-box { margin: 10px 0; width: 92vw; max-width: 380px; aspect-ratio: 1/1; border: 6px solid var(--c); position: relative; border-radius: 12px; display: none; }
        #board { display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr); height: 100%; }
        .sq { display: flex; justify-content: center; align-items: center; position: relative; }
        .sq.l { background: var(--sl); } .sq.d { background: var(--sd); }
        .sq.hint::after { content: ''; width: 12px; height: 12px; background: var(--p); border-radius: 50%; opacity: 0.5; }
        .selected { background: rgba(0, 212, 255, 0.4) !important; }

        .hud { width: 100%; background: var(--c); padding: 15px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--p); margin-top: 60px; font-size: 12px; font-weight: 900; }
        #social-panel { width: 90%; max-height: 200px; overflow-y: auto; background: #000; border: 1px solid #222; border-radius: 10px; margin-top: 10px; padding: 10px; display: none; }
        #chat-window { position: fixed; bottom: 10px; right: 10px; width: 250px; height: 300px; background: var(--c); border: 1px solid var(--p); display: none; flex-direction: column; z-index: 120; border-radius: 10px; }
        #chat-msgs { flex: 1; overflow-y: auto; padding: 10px; font-size: 11px; text-align: left; }
    </style>
</head>
<body onclick="initAudio()">

    <div id="global-nav" class="nav-ui" style="display:none">
        <div class="btn-ui" onclick="confirmExit()">üè† HOME</div>
        <div class="btn-ui" id="mute-btn" onclick="toggleMute()">üîä SOUND</div>
    </div>

    <div id="auth-screen" class="overlay">
        <div class="architect-tag">ARCHITECT PRO</div>
        <div class="credits">DEVELOPED BY MAUTASIM</div>
        <div class="auth-card">
            <input type="text" id="user-in" placeholder="USERNAME">
            <input type="password" id="pass-in" placeholder="PASSKEY">
            <button class="btn-main" onclick="handleAuth()">INITIALIZE</button>
            <p style="font-size: 10px; color: #555; margin-top: 15px; cursor:pointer">CREATE ACCOUNT</p>
        </div>
    </div>

    <div id="home-screen" class="overlay" style="display:none">
        <div class="architect-tag" id="user-display">MAUTASIM</div>
        <div class="credits">DEVELOPED BY MAUTASIM</div>
        <div class="dashboard">
            <div class="menu-item" onclick="prepareGame('bot')"><span>NEURAL CHESS</span></div>
            <div class="menu-item" onclick="prepareLudo()"><span>NEURAL LUDO</span></div>
            <div class="menu-item" onclick="toggleSocial()"><span>SOCIAL HUB</span></div>
            <div class="menu-item" onclick="doLogout()" style="border-color: #f44336;"><span>LOGOUT</span></div>
        </div>
        <div id="social-panel">
            <input type="text" id="friend-id" placeholder="FRIEND ID">
            <button class="btn-main" style="padding: 5px; font-size: 9px;" onclick="addFriend()">ADD FRIEND</button>
            <div id="friends-list"></div>
        </div>
    </div>

    <div id="ai-setup" class="overlay" style="display:none">
        <div class="auth-card">
            <h3 style="color:var(--p); font-size:14px;">CHESS NEURAL OVERRIDE</h3>
            <select id="ai-level-select">
                <option value="architect">LVL: ARCHITECT (MAX)</option>
                <option value="expert">LVL: EXPERT</option>
            </select>
            <button class="btn-main" onclick="startAI()">ENGAGE</button>
            <button class="btn-main" style="background:none; border:1px solid #444; color:#777" onclick="showDashboard()">BACK</button>
        </div>
    </div>

    <div id="ludo-config" class="overlay" style="display:none">
        <div class="auth-card">
            <h3 style="color:var(--p); font-size:14px;">LUDO CONFIGURATION</h3>
            <select id="ludo-count" onchange="updateLudoNames()">
                <option value="2">2 PLAYERS</option>
                <option value="3">3 PLAYERS</option>
                <option value="4">4 PLAYERS</option>
            </select>
            <div id="ludo-names-inputs">
                <input type="text" id="ln1" placeholder="PLAYER 1 (RED)">
                <input type="text" id="ln2" placeholder="PLAYER 2 (GREEN)">
            </div>
            <button class="btn-main" onclick="startLudo()">START LUDO</button>
            <button class="btn-main" style="background:none; border:1px solid #444; color:#777" onclick="showDashboard()">BACK</button>
        </div>
    </div>

    <div class="hud">
        <div id="p1-label">---</div>
        <div style="color:var(--p)" id="turn-status">VS</div>
        <div id="p2-label" style="text-align:right">---</div>
    </div>

    <div id="board-box"><div id="board"></div></div>

    <div id="ludo-board">
        <div class="ludo-grid" id="l-grid"></div>
        <div class="dice-btn" id="l-dice" onclick="rollLudoDice()">?</div>
    </div>

    <div id="chat-window">
        <div style="padding: 5px; border-bottom: 1px solid var(--p); font-size: 10px;">CHAT: <span id="chatting-with"></span> <button onclick="closeChat()" style="float:right; background:none; color:red; border:none;">X</button></div>
        <div id="chat-msgs"></div>
        <input type="text" id="chat-input" placeholder="Type..." onkeydown="if(event.key==='Enter') sendChat()">
    </div>

<script>
    const game = new Chess();
    let currentApp = 'chess', currentUser = null, selectedSq = null, audioCtx = null, muted = false;
    let peer = null, conn = null, aiDifficulty = 'architect';

    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function toggleMute() { muted = !muted; document.getElementById('mute-btn').innerText = muted ? "üîá MUTED" : "üîä SOUND"; }
    function playSound(f) { if(muted || !audioCtx) return; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); o.start(); o.stop(audioCtx.currentTime + 0.1); }

    function handleAuth() {
        const u = document.getElementById('user-in').value.trim().toUpperCase();
        if(!u) return;
        currentUser = u;
        localStorage.setItem('arch_user', u);
        peer = new Peer('ARCH-' + currentUser);
        peer.on('connection', c => { conn = c; document.getElementById('chat-window').style.display = 'flex'; });
        showDashboard();
    }

    function showDashboard() {
        document.querySelectorAll('.overlay').forEach(o => o.style.display='none');
        document.getElementById('home-screen').style.display = 'flex';
        document.getElementById('board-box').style.display = 'none';
        document.getElementById('ludo-board').style.display = 'none';
        document.getElementById('global-nav').style.display = 'none';
        document.getElementById('user-display').innerText = currentUser;
    }

    // --- CHESS ENGINE (RESTORED) ---
    function prepareGame(mode) {
        currentApp = 'chess';
        document.getElementById('ai-setup').style.display = 'flex';
    }
    function startAI() {
        aiDifficulty = document.getElementById('ai-level-select').value;
        document.getElementById('p1-label').innerText = currentUser;
        document.getElementById('p2-label').innerText = "ARCH-AI";
        document.getElementById('board-box').style.display = 'block';
        document.getElementById('global-nav').style.display = 'flex';
        document.querySelectorAll('.overlay').forEach(o => o.style.display='none');
        game.reset(); initBoard();
    }
    function initBoard() {
        const boardEl = document.getElementById('board');
        boardEl.innerHTML = '';
        for (let i = 0; i < 64; i++) {
            const sq = document.createElement('div');
            sq.className = `sq ${(Math.floor(i/8) + i%8) % 2 === 0 ? 'l' : 'd'}`;
            sq.dataset.id = String.fromCharCode(97 + (i%8)) + (8 - Math.floor(i/8));
            sq.onclick = () => handleChessInput(sq.dataset.id);
            boardEl.appendChild(sq);
        }
        renderChess();
    }
    function handleChessInput(id) {
        if (selectedSq) {
            const move = game.move({ from: selectedSq, to: id, promotion: 'q' });
            if (move) {
                playSound(400); selectedSq = null; renderChess();
                if(!game.game_over()) setTimeout(chessAIMove, 500);
                return;
            }
        }
        const p = game.get(id);
        if (p && p.color === game.turn()) { selectedSq = id; renderChess(); }
    }
    function chessAIMove() {
        const moves = game.moves();
        const bestMove = moves.find(m => m.includes('#')) || moves.find(m => m.includes('x')) || moves[Math.floor(Math.random() * moves.length)];
        game.move(bestMove); playSound(300); renderChess();
    }
    function renderChess() {
        document.querySelectorAll('.sq').forEach(s => {
            const p = game.get(s.dataset.id); s.innerHTML = '';
            s.classList.remove('selected', 'hint');
            if(s.dataset.id === selectedSq) s.classList.add('selected');
            if(selectedSq && game.moves({square: selectedSq}).some(m => m.includes(s.dataset.id))) s.classList.add('hint');
            if (p) {
                const img = document.createElement('img');
                img.src = `https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/alpha/${p.color}${p.type.toUpperCase()}.svg`;
                img.className = 'piece' + (p.color === 'b' ? ' black' : '');
                s.appendChild(img);
            }
        });
    }

    // --- LUDO ENGINE (REAL DESIGN) ---
    function prepareLudo() {
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('ludo-config').style.display = 'flex';
        updateLudoNames();
    }
    function updateLudoNames() {
        const count = document.getElementById('ludo-count').value;
        const container = document.getElementById('ludo-names-inputs');
        container.innerHTML = '';
        const colors = ['RED', 'GREEN', 'YELLOW', 'BLUE'];
        for(let i=0; i<count; i++) {
            container.innerHTML += `<input type="text" id="ln${i+1}" placeholder="PLAYER ${i+1} (${colors[i]})">`;
        }
    }
    function startLudo() {
        currentApp = 'ludo';
        document.getElementById('ludo-config').style.display = 'none';
        document.getElementById('ludo-board').style.display = 'block';
        document.getElementById('global-nav').style.display = 'flex';
        document.getElementById('p1-label').innerText = document.getElementById('ln1').value || "RED";
        document.getElementById('p2-label').innerText = document.getElementById('ln2').value || "GREEN";
        initLudoGrid();
    }
    function initLudoGrid() {
        const grid = document.getElementById('l-grid');
        grid.innerHTML = '';
        for(let i=0; i<225; i++) {
            const r = Math.floor(i/15), c = i%15;
            const cell = document.createElement('div');
            cell.className = 'cell';
            if(r<6 && c<6) cell.classList.add('red');
            if(r<6 && c>8) cell.classList.add('green');
            if(r>8 && c<6) cell.classList.add('blue');
            if(r>8 && c>8) cell.classList.add('yellow');
            if((r==7 && c>0 && c<7)) cell.classList.add('red');
            if((c==7 && r>0 && r<7)) cell.classList.add('green');
            if((r==7 && c>8 && c<14)) cell.classList.add('yellow');
            if((c==7 && r>8 && r<14)) cell.classList.add('blue');
            grid.appendChild(cell);
        }
    }
    function rollLudoDice() {
        const val = Math.floor(Math.random() * 6) + 1;
        document.getElementById('l-dice').innerText = val;
        playSound(500);
    }

    // --- CORE ---
    function toggleSocial() { const p = document.getElementById('social-panel'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; }
    function addFriend() {
        const id = document.getElementById('friend-id').value.trim();
        if(!id) return;
        let friends = JSON.parse(localStorage.getItem('friends_'+currentUser) || "[]");
        friends.push(id); localStorage.setItem('friends_'+currentUser, JSON.stringify(friends));
        renderFriends();
    }
    function renderFriends() {
        const list = document.getElementById('friends-list'); list.innerHTML = '';
        let friends = JSON.parse(localStorage.getItem('friends_'+currentUser) || "[]");
        friends.forEach(f => {
            const div = document.createElement('div');
            div.style = "padding:8px; border-bottom:1px solid #111; font-size:10px; cursor:pointer;";
            div.innerText = f + " (CHAT)";
            div.onclick = () => { conn = peer.connect('ARCH-'+f); document.getElementById('chat-window').style.display = 'flex'; };
            list.appendChild(div);
        });
    }
    function confirmExit() { if(confirm("Exit game to Hub?")) showDashboard(); }
    function doLogout() { localStorage.removeItem('arch_user'); location.reload(); }
    window.onload = () => { const s = localStorage.getItem('arch_user'); if(s) { currentUser = s; showDashboard(); } };
</script>
</body>
</html>
