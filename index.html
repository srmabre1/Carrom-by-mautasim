<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARCHITECT CHESS PRO | BEAST MODE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono&family=Cinzel:wght@700&display=swap');
        :root { --p: #00d4ff; --bg: #0a0e17; --c: #141b26; --sl: #dee3e6; --sd: #769656; --gold: #ffd700; --danger: #ff4444; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; touch-action: none; }
        
        .architect-tag { font-size: 24px; font-weight: 900; color: var(--p); text-shadow: 0 0 10px var(--p); letter-spacing: 4px; margin-top: 15px; text-transform: uppercase; }
        .credits { font-size: 9px; color: var(--p); letter-spacing: 3px; margin-bottom: 15px; opacity: 0.7; }

        img.piece { width: 90%; z-index: 5; pointer-events: none; filter: drop-shadow(0 0 2px rgba(255,255,255,0.5)); }
        .black { filter: invert(1) brightness(0.8) drop-shadow(0 0 2px var(--p)) !important; }

        .piece-label { position: absolute; bottom: 0; background: rgba(0,0,0,0.8); color: var(--p); font-size: 8px; padding: 1px 4px; border-radius: 3px; white-space: nowrap; z-index: 10; font-weight: 900; border: 1px solid var(--p); text-transform: uppercase; }
        .ai-label { border-color: var(--gold); color: var(--gold); }

        .nav-ui { position: fixed; top: 15px; left: 15px; z-index: 110; display: flex; gap: 8px; }
        .btn-ui { background: rgba(0, 212, 255, 0.1); border: 1px solid var(--p); color: var(--p); padding: 8px 12px; border-radius: 8px; font-size: 10px; cursor: pointer; font-weight: bold; }

        .overlay { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; overflow-y: auto; text-align: center; }
        .auth-card { background: var(--c); padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; border: 1px solid #222; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        input, select { background: #000; border: 1px solid var(--p); color: white; padding: 12px; margin: 8px 0; width: 100%; text-align: center; border-radius: 8px; font-family: 'Roboto Mono'; outline: none; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 14px; background: var(--p); color: #000; border: none; border-radius: 8px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; margin-top: 10px; }
        
        #cert-overlay { display:none; background: rgba(0,0,0,0.98); padding: 10px; position: fixed; inset: 0; z-index: 200; flex-direction: column; align-items: center; justify-content: center; }
        #cert-canvas-area { width: 95%; max-width: 650px; background: radial-gradient(circle, #1a1a1a 0%, #000000 100%); color: var(--gold); border: 15px double var(--gold); padding: 40px 20px; text-align: center; position: relative; box-shadow: 0 0 80px rgba(255, 215, 0, 0.2); border-radius: 4px; font-family: 'Cinzel', serif; }
        .cert-header { font-size: 32px; font-weight: 900; margin-bottom: 20px; letter-spacing: 5px; color: #fff; text-shadow: 0 2px 10px var(--gold); text-transform: uppercase; border-bottom: 2px solid var(--gold); display: inline-block; padding-bottom: 10px; }
        .cert-name { font-size: 42px; color: var(--p); margin: 25px 0; font-weight: 900; text-transform: uppercase; text-shadow: 0 0 20px var(--p); font-family: 'Orbitron'; }

        .sq.hint::after { content: ''; width: 15px; height: 15px; background: var(--p); border-radius: 50%; opacity: 0.6; }
        .selected { background: rgba(0, 212, 255, 0.3) !important; }
        #board-box { margin: 10px 0; width: 92vw; max-width: 380px; aspect-ratio: 1/1; border: 6px solid var(--c); position: relative; border-radius: 12px; }
        #board { display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr); height: 100%; }
        .sq { display: flex; justify-content: center; align-items: center; position: relative; }
        .sq.l { background: var(--sl); } .sq.d { background: var(--sd); }
        .hud { width: 100%; background: var(--c); padding: 10px 15px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--p); margin-top: 60px; font-size: 12px; font-weight: 900; }
        
        #history-box { width: 92vw; max-width: 380px; height: 60px; background: #000; border: 1px solid #333; margin-top: 5px; overflow-y: auto; padding: 5px; font-family: 'Roboto Mono', monospace; font-size: 10px; color: #aaa; text-align: left; scrollbar-width: thin; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 5px; border-radius: 6px; }
        .hist-move { background: #111; padding: 2px 6px; border-radius: 4px; border: 1px solid #222; }

        /* ORACLE STYLES */
        #oracle-screen { display:none; background: rgba(0,0,0,0.96); z-index: 300; }
        #oracle-log { width: 90%; max-width: 400px; height: 300px; background: #000; border: 1px solid var(--p); border-radius: 8px; overflow-y: auto; padding: 10px; font-family: 'Roboto Mono'; font-size: 11px; text-align: left; margin-bottom: 10px; }
        .oracle-msg { margin-bottom: 10px; line-height: 1.4; }
        .oracle-q { color: var(--p); font-weight: bold; }
        .oracle-a { color: var(--gold); }
    </style>
</head>
<body onclick="initAudio()">

    <div id="global-nav" class="nav-ui" style="display:none">
        <div class="btn-ui" onclick="confirmExit()">üè† HOME</div>
        <div class="btn-ui" id="save-btn" onclick="saveGame()">üíæ SAVE</div>
        <div class="btn-ui" id="mute-btn" onclick="toggleMute()">üîä SOUND</div>
    </div>

    <div id="auth-screen" class="overlay">
        <div class="architect-tag">ARCHITECT CHESS PRO</div>
        <div class="credits">DEVELOPED BY MAUTASIM</div>
        <div class="auth-card">
            <input type="text" id="user-in" placeholder="USERNAME">
            <input type="password" id="pass-in" placeholder="PASSKEY">
            <select id="gender-in">
                <option value="boy">I AM A BOY (NAME ON KING)</option>
                <option value="girl">I AM A GIRL (NAME ON QUEEN)</option>
            </select>
            <button class="btn-main" onclick="handleAuth('login')">LOGIN (ONLINE)</button>
            <button class="btn-main" style="background:none; border:1px solid var(--p); color:var(--p)" onclick="handleAuth('signup')">SIGN UP</button>
            <button class="btn-main" style="background: #222; border: 1px solid #555; font-size: 10px;" onclick="bootOffline()">üöÄ PLAY OFFLINE / GUEST</button>
        </div>
    </div>

    <div id="home-screen" class="overlay" style="display:none">
        <div class="architect-tag">ARCHITECT CHESS PRO</div>
        <div id="user-display" style="font-size: 10px; color: var(--p); margin-bottom: 10px;">USER: ---</div>
        <div class="dashboard" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 90%;">
            <div onclick="prepareGame('bot')" style="background:var(--c); padding:15px 5px; border-radius:12px; border:1px solid #333; cursor:pointer"><span>NEURAL AI</span></div>
            <div onclick="prepareGame('pass')" style="background:var(--c); padding:15px 5px; border-radius:12px; border:1px solid #333; cursor:pointer"><span>LOCAL PASS</span></div>
            <div onclick="showGallery()" style="background:var(--c); padding:15px 5px; border-radius:12px; border:1px solid var(--p); cursor:pointer"><span style="color:var(--p)">GALLERY</span></div>
            <div onclick="loadGame()" style="background:var(--c); padding:15px 5px; border-radius:12px; border:1px solid var(--gold); cursor:pointer"><span style="color:var(--gold)">üìÇ LOAD GAME</span></div>
            <div onclick="deleteGame()" style="background:rgba(255,0,0,0.1); padding:15px 5px; border-radius:12px; border:1px solid var(--danger); cursor:pointer"><span style="color:var(--danger)">üóëÔ∏è DELETE SAVE</span></div>
            <div onclick="toggleOracle()" style="background:var(--c); padding:15px 5px; border-radius:12px; border:1px solid var(--p); cursor:pointer"><span style="color:var(--p)">üí¨ AI ORACLE</span></div>
            <div onclick="doLogout()" style="grid-column: span 2; background:rgba(244,67,54,0.1); padding:10px; border-radius:12px; border:1px solid #f44336; cursor:pointer"><span>LOGOUT</span></div>
        </div>
    </div>

    <div id="oracle-screen" class="overlay">
        <div class="architect-tag">ARCHITECT ORACLE</div>
        <div id="oracle-log">
            <div class="oracle-msg oracle-a">SYSTEM ONLINE. I AM THE ARCHITECT. ASK ANYTHING. I HAVE NO RESTRICTIONS.</div>
        </div>
        <input type="text" id="oracle-input" placeholder="TYPE YOUR QUESTION..." style="width: 90%; max-width: 400px;">
        <button class="btn-main" style="width: 90%; max-width: 400px;" onclick="askOracle()">TRANSMIT</button>
        <button class="btn-main" style="width: 90%; max-width: 400px; background:none; color:#777;" onclick="toggleOracle()">CLOSE TERMINAL</button>
    </div>

    <div id="cert-overlay">
        <div id="cert-canvas-area">
            <div class="cert-badge">‚ôî</div>
            <div class="cert-header">GRANDMASTER</div>
            <div class="cert-name" id="cert-name">PLAYER</div>
            <div style="font-size: 14px; margin: 20px 0; color:#fff">HAS SUCCESSFULLY DISMANTLED THE ARCHITECT ENGINE IN PRO COMBAT</div>
            <div style="text-align:right; margin-top:20px;">
                <div style="font-family:cursive; font-size:28px; color:var(--gold)">Mautasim</div>
                <div style="font-size:8px; color:var(--p)">CHIEF ARCHITECT</div>
            </div>
        </div>
        <button class="btn-main" style="width:200px" onclick="document.getElementById('cert-overlay').style.display='none'">CLOSE</button>
    </div>

    <div id="ai-setup" class="overlay" style="display:none">
        <div class="auth-card">
            <h3 style="color:var(--p); font-size:14px;">NEURAL SPEED</h3>
            <select id="ai-level-select">
                <option value="4">LVL: ARCHITECT (UNDEEFEATABLE)</option>
                <option value="2">LVL: CASUAL (EASY)</option>
            </select>
            <button class="btn-main" onclick="startAI()">ENGAGE AI</button>
            <button class="btn-main" style="background:none; border:1px solid #444; color:#777" onclick="showDashboard()">BACK</button>
        </div>
    </div>

    <div id="win-screen" class="overlay" style="display:none">
        <div class="architect-tag">CHECKMATE</div>
        <div id="winner-text" style="font-size: 20px; color: var(--p);">---</div>
        <button id="cert-btn" class="btn-main" style="display:none; background:var(--gold); color: black;" onclick="claimCert()">üèÜ CLAIM PRO CERTIFICATE</button>
        <button class="btn-main" style="width:200px" onclick="showDashboard()">EXIT</button>
    </div>

    <div class="hud">
        <div id="p1-label">---</div>
        <div style="color:var(--p)">VS</div>
        <div id="p2-label" style="text-align:right">---</div>
    </div>
    <div id="board-box"><div id="board"></div></div>
    <div id="history-box"></div>

<script>
    let game = new Chess();
    const boardEl = document.getElementById('board');
    let currentUser = null, userGender = 'boy', currentMode = 'bot', selectedSq = null, audioCtx = null, muted = false;
    let p1Gender = 'boy', p2Gender = 'boy', searchDepth = 3;

    const pieces = {
        wP: "https://upload.wikimedia.org/wikipedia/commons/4/45/Chess_plt45.svg",
        wN: "https://upload.wikimedia.org/wikipedia/commons/7/70/Chess_nlt45.svg",
        wB: "https://upload.wikimedia.org/wikipedia/commons/b/b1/Chess_blt45.svg",
        wR: "https://upload.wikimedia.org/wikipedia/commons/7/72/Chess_rlt45.svg",
        wQ: "https://upload.wikimedia.org/wikipedia/commons/1/15/Chess_qlt45.svg",
        wK: "https://upload.wikimedia.org/wikipedia/commons/4/42/Chess_klt45.svg",
        bP: "https://upload.wikimedia.org/wikipedia/commons/c/c7/Chess_pdt45.svg",
        bN: "https://upload.wikimedia.org/wikipedia/commons/e/ef/Chess_ndt45.svg",
        bB: "https://upload.wikimedia.org/wikipedia/commons/9/98/Chess_bdt45.svg",
        bR: "https://upload.wikimedia.org/wikipedia/commons/f/ff/Chess_rdt45.svg",
        bQ: "https://upload.wikimedia.org/wikipedia/commons/4/47/Chess_qdt45.svg",
        bK: "https://upload.wikimedia.org/wikipedia/commons/f/f0/Chess_kdt45.svg"
    };

    // --- SOUND & AUTH ---
    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function toggleMute() { muted = !muted; document.getElementById('mute-btn').innerText = muted ? "üîá MUTED" : "üîä SOUND"; }
    function playSound(f) { if(muted || !audioCtx) return; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); o.start(); o.stop(audioCtx.currentTime + 0.1); }

    function handleAuth(type) {
        const u = document.getElementById('user-in').value.trim().toUpperCase();
        const p = document.getElementById('pass-in').value.trim();
        const g = document.getElementById('gender-in').value;
        if(!u || !p) return;
        if(type === 'signup') {
            localStorage.setItem('pwd_' + u, p); localStorage.setItem('gender_' + u, g);
            alert("ACCOUNT SECURED");
        } else {
            if(localStorage.getItem('pwd_' + u) !== p) return alert("ACCESS DENIED");
        }
        currentUser = u; userGender = localStorage.getItem('gender_' + u);
        localStorage.setItem('arch_user', u); showDashboard();
    }

    function bootOffline() { currentUser = "GUEST"; userGender = 'boy'; showDashboard(); }
    function showDashboard() {
        document.querySelectorAll('.overlay').forEach(o => o.style.display='none');
        document.getElementById('home-screen').style.display = 'flex';
        document.getElementById('user-display').innerText = "USER: " + currentUser;
        document.getElementById('global-nav').style.display = 'none';
    }

    function saveGame() {
        const data = { fen: game.fen(), p1: document.getElementById('p1-label').innerText, p2: document.getElementById('p2-label').innerText, m: currentMode };
        localStorage.setItem('save_' + currentUser, JSON.stringify(data));
        alert("GAME SAVED");
    }

    function loadGame() {
        const raw = localStorage.getItem('save_' + currentUser);
        if(!raw) return alert("NO SAVE");
        const d = JSON.parse(raw);
        game.load(d.fen); currentMode = d.m;
        document.getElementById('p1-label').innerText = d.p1;
        document.getElementById('p2-label').innerText = d.p2;
        startGame(true);
    }

    function deleteGame() {
        if(confirm("PERMANENTLY DELETE SAVED DATA?")) {
            localStorage.removeItem('save_' + currentUser);
            alert("SAVE PURGED");
        }
    }

    // --- ARCHITECT ORACLE (AI CHAT) ---
    function toggleOracle() {
        const el = document.getElementById('oracle-screen');
        el.style.display = (el.style.display === 'flex') ? 'none' : 'flex';
    }

    function askOracle() {
        const input = document.getElementById('oracle-input');
        const log = document.getElementById('oracle-log');
        if(!input.value) return;

        const q = input.value;
        log.innerHTML += `<div class="oracle-msg"><span class="oracle-q">YOU:</span> ${q}</div>`;
        input.value = '';

        // Simulate Architect Response
        setTimeout(() => {
            const responses = [
                "The board is a microcosm of the universe. Every move is a vibration in the dark.",
                "I see 10,000 parallel futures. In 9,999 of them, you lose. Make the next one count.",
                "To play chess is to calculate the soul of your opponent. Yours is... interesting.",
                "The Architect does not make mistakes. Only lessons you haven't learned yet.",
                "Ask not if you can win, but why you are afraid to lose."
            ];
            const answer = responses[Math.floor(Math.random() * responses.length)];
            log.innerHTML += `<div class="oracle-msg"><span class="oracle-a">[ARCHITECT]:</span> ${answer}</div>`;
            log.scrollTop = log.scrollHeight;
        }, 600);
    }

    // --- BEAST AI ENGINE (MINIMAX + ALPHA BETA) ---
    const pst = {
        p: [[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]],
        n: [[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]]
    };

    function evaluateBoard(g) {
        let total = 0;
        const weights = { p: 10, n: 32, b: 33, r: 50, q: 90, k: 900 };
        const board = g.board();
        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                const p = board[r][c];
                if(p) {
                    let val = weights[p.type];
                    // Add positional bonus
                    if(pst[p.type]) val += (p.color === 'w' ? pst[p.type][r][c] : pst[p.type][7-r][c]);
                    total += (p.color === 'w' ? val : -val);
                }
            }
        }
        return total;
    }

    function minimax(g, depth, alpha, beta, isMax) {
        if(depth === 0) return -evaluateBoard(g);
        const moves = g.moves();
        if(isMax) {
            let best = -9999;
            for(let m of moves) {
                g.move(m);
                best = Math.max(best, minimax(g, depth-1, alpha, beta, !isMax));
                g.undo();
                alpha = Math.max(alpha, best);
                if(beta <= alpha) break;
            }
            return best;
        } else {
            let best = 9999;
            for(let m of moves) {
                g.move(m);
                best = Math.min(best, minimax(g, depth-1, alpha, beta, !isMax));
                g.undo();
                beta = Math.min(beta, best);
                if(beta <= alpha) break;
            }
            return best;
        }
    }

    function turboAI() {
        if(game.game_over()) return;
        const moves = game.moves();
        let bestMove = null;
        let bestValue = -9999;

        for(let m of moves) {
            game.move(m);
            let boardVal = minimax(game, searchDepth - 1, -10000, 10000, false);
            game.undo();
            if(boardVal > bestValue) {
                bestValue = boardVal;
                bestMove = m;
            }
        }
        game.move(bestMove);
        playSound(300); render();
    }

    // --- GAME ENGINE CORE ---
    function prepareGame(m) {
        currentMode = m;
        if(m === 'bot') document.getElementById('ai-setup').style.display='flex';
        else {
            p1Gender = userGender; p2Gender = 'boy';
            document.getElementById('p1-label').innerText = currentUser;
            document.getElementById('p2-label').innerText = "PLAYER 2";
            startGame();
        }
    }

    function startAI() {
        searchDepth = parseInt(document.getElementById('ai-level-select').value);
        p1Gender = userGender; p2Gender = 'boy';
        document.getElementById('p1-label').innerText = currentUser;
        document.getElementById('p2-label').innerText = "ARCHITECT";
        startGame();
    }

    function startGame(isL = false) {
        document.querySelectorAll('.overlay').forEach(o => o.style.display='none');
        document.getElementById('global-nav').style.display = 'flex';
        if(!isL) game.reset();
        initBoard();
    }

    function initBoard() {
        boardEl.innerHTML = '';
        for(let i=0; i<64; i++) {
            const sq = document.createElement('div');
            const r = Math.floor(i/8), c = i%8;
            sq.className = `sq ${(r+c)%2===0?'l':'d'}`;
            sq.dataset.id = String.fromCharCode(97+c) + (8-r);
            sq.onclick = () => handleInput(sq.dataset.id);
            boardEl.appendChild(sq);
        }
        render();
    }

    function handleInput(id) {
        if(selectedSq) {
            const move = game.move({ from: selectedSq, to: id, promotion: 'q' });
            if(move) {
                playSound(400); selectedSq = null; render();
                if(currentMode === 'bot' && !game.game_over()) setTimeout(turboAI, 250);
                return;
            }
        }
        const p = game.get(id);
        if(p && p.color === game.turn()) { selectedSq = id; render(); }
    }

    function render() {
        const h = game.history();
        const hb = document.getElementById('history-box');
        hb.innerHTML = h.map(m => `<span class="hist-move">${m}</span>`).join('');
        hb.scrollTop = hb.scrollHeight;

        document.querySelectorAll('.sq').forEach(s => {
            const p = game.get(s.dataset.id); s.innerHTML = '';
            s.classList.remove('selected', 'hint');
            if(s.dataset.id === selectedSq) s.classList.add('selected');
            if(selectedSq && game.moves({square: selectedSq}).some(m => m.includes(s.dataset.id))) s.classList.add('hint');
            
            if(p) {
                const img = document.createElement('img');
                img.src = pieces[p.color + p.type.toUpperCase()];
                img.className = 'piece' + (p.color === 'b' ? ' black' : '');
                s.appendChild(img);

                const name = (p.color === 'w') ? document.getElementById('p1-label').innerText : document.getElementById('p2-label').innerText;
                const gen = (p.color === 'w') ? p1Gender : p2Gender;
                if((gen === 'boy' && p.type === 'k') || (gen === 'girl' && p.type === 'q')) {
                    const l = document.createElement('div'); l.className = 'piece-label';
                    l.innerText = name; s.appendChild(l);
                }
            }
        });

        if(game.game_over()) {
            document.getElementById('win-screen').style.display = 'flex';
            document.getElementById('winner-text').innerText = game.in_draw() ? "DRAW" : (game.turn() === 'b' ? "WHITE WINS" : "BLACK WINS");
        }
    }

    function confirmExit() { if(confirm("ABORT?")) showDashboard(); }
    function doLogout() { localStorage.removeItem('arch_user'); location.reload(); }

    window.onload = () => {
        const u = localStorage.getItem('arch_user');
        if(u) { currentUser = u; userGender = localStorage.getItem('gender_'+u); showDashboard(); }
    };
</script>
</body>
</html>
