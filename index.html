<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARCHITECT CHESS PRO | V20</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Roboto+Mono&display=swap');
        :root { --p: #00d4ff; --bg: #0a0e17; --c: #141b26; --sl: #dee3e6; --sd: #769656; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; touch-action: none; }
        
        /* Animated Name */
        .architect-tag { font-size: 24px; font-weight: 900; color: var(--p); text-shadow: 0 0 10px var(--p); letter-spacing: 4px; margin: 15px 0; text-transform: uppercase; animation: glowPulse 2s infinite ease-in-out; }
        @keyframes glowPulse { 0% { text-shadow: 0 0 5px var(--p); opacity: 0.8; } 50% { text-shadow: 0 0 20px var(--p), 0 0 30px var(--p); opacity: 1; } 100% { text-shadow: 0 0 5px var(--p); opacity: 0.8; } }

        /* Piece Visibility Fix */
        img.piece { width: 90%; z-index: 5; pointer-events: none; filter: drop-shadow(0 0 2px rgba(255,255,255,0.5)); }
        .black { filter: invert(1) brightness(0.8) drop-shadow(0 0 2px var(--p)) !important; }

        .nav-ui { position: fixed; top: 15px; left: 15px; z-index: 110; display: flex; gap: 8px; }
        .btn-ui { background: rgba(0, 212, 255, 0.1); border: 1px solid var(--p); color: var(--p); padding: 8px 12px; border-radius: 8px; font-size: 10px; cursor: pointer; font-weight: bold; }
        .overlay { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; overflow-y: auto; }
        .auth-card { background: var(--c); padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; border: 1px solid #222; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        input { background: #000; border: 1px solid var(--p); color: white; padding: 12px; margin: 8px 0; width: 100%; text-align: center; border-radius: 8px; font-family: 'Roboto Mono'; outline: none; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 14px; background: var(--p); color: #000; border: none; border-radius: 8px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; margin-top: 10px; }
        
        /* Tactical Dots (Hints) */
        .sq.hint::after { content: ''; width: 15px; height: 15px; background: var(--p); border-radius: 50%; opacity: 0.6; box-shadow: 0 0 10px var(--p); z-index: 2; }
        .selected { background: rgba(0, 212, 255, 0.3) !important; }

        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 90%; margin-top: 15px;}
        .menu-item { background: var(--c); border: 1px solid #333; padding: 15px 5px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.2s; }
        .menu-item:active { background: var(--p); }
        .menu-item span { display: block; font-size: 10px; font-weight: 900; color: #fff; }

        #board-box { margin: 10px 0; width: 92vw; max-width: 380px; aspect-ratio: 1/1; border: 6px solid var(--c); position: relative; border-radius: 12px; overflow: hidden; }
        #board { display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr); height: 100%; }
        .sq { display: flex; justify-content: center; align-items: center; position: relative; }
        .sq.l { background: var(--sl); } .sq.d { background: var(--sd); }
        .hud { width: 100%; background: var(--c); padding: 15px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--p); box-sizing: border-box; margin-top: 60px; }
    </style>
</head>
<body onclick="initAudio()">

    <div id="global-nav" class="nav-ui" style="display:none">
        <div class="btn-ui" onclick="confirmExit()">üè† HOME</div>
    </div>

    <div id="auth-screen" class="overlay">
        <div class="architect-tag">ARCHITECT PRO</div>
        <div style="font-size: 8px; color: #555; letter-spacing: 2px; margin-bottom: 15px;">BY MAUTASIM</div>
        <div class="auth-card">
            <input type="text" id="user-in" placeholder="USERNAME">
            <input type="password" id="pass-in" placeholder="PASSKEY">
            <button class="btn-main" onclick="handleAuth()">INITIALIZE</button>
            <p style="font-size: 10px; color: #555; margin-top: 15px; cursor:pointer" onclick="toggleAuth()">CREATE ACCOUNT</p>
        </div>
    </div>

    <div id="home-screen" class="overlay" style="display:none">
        <div class="architect-tag">MAUTASIM</div>
        <div id="lvl-status" style="font-size: 11px; color: var(--p); margin-bottom: 5px;">LVL 1</div>
        <div class="dashboard">
            <div class="menu-item" onclick="prepareGame('bot')"><span>NEURAL AI</span></div>
            <div class="menu-item" onclick="prepareGame('online')"><span>GLOBAL P2P</span></div>
            <div class="menu-item" onclick="prepareGame('pass')"><span>LOCAL PASS</span></div>
            <div class="menu-item" onclick="doLogout()" style="border-color: #f44336;"><span>LOGOUT</span></div>
        </div>
        <div id="history-list" style="width: 90%; margin-top: 20px; font-size: 10px;"></div>
    </div>

    <div id="game-setup" class="overlay" style="display:none">
        <div class="auth-card">
            <h3 style="font-size:12px; color:var(--p)">BATTLE CONFIG</h3>
            <div id="setup-inputs">
                <input type="text" id="p2-input" placeholder="OPPONENT NAME">
            </div>
            <p style="font-size: 9px; margin-top:15px">BOARD THEME</p>
            <div style="display:flex; gap:10px; justify-content:center; margin:10px 0;">
                <button class="btn-ui" onclick="setTheme('classic')">WOOD</button>
                <button class="btn-ui" onclick="setTheme('neon')">NEON</button>
                <button class="btn-ui" onclick="setTheme('slate')">SLATE</button>
            </div>
            <button class="btn-main" onclick="confirmStart()">ENGAGE</button>
            <button class="btn-main" style="background:none; border:1px solid #444; color:#777" onclick="showDashboard()">CANCEL</button>
        </div>
    </div>

    <div class="hud">
        <div id="p1-label">---</div>
        <div style="color:var(--p)">VS</div>
        <div id="p2-label" style="text-align:right">---</div>
    </div>
    <div id="board-box"><div id="board"></div></div>

<script>
    const game = new Chess();
    const boardEl = document.getElementById('board');
    let currentUser = null, currentMode = 'bot', selectedSq = null, audioCtx = null, myColor = 'w';

    const themes = { 
        classic: { sl: '#ebecd0', sd: '#779556' }, 
        neon: { sl: '#1a1a1a', sd: '#00d4ff' }, 
        slate: { sl: '#475569', sd: '#1e293b' } 
    };

    function setTheme(t) {
        document.documentElement.style.setProperty('--sl', themes[t].sl);
        document.documentElement.style.setProperty('--sd', themes[t].sd);
    }

    function confirmExit() {
        if(confirm("Exit match? Your progress will be lost.")) {
            showDashboard();
        }
    }

    function handleAuth() {
        const u = document.getElementById('user-in').value.trim().toUpperCase();
        if(!u) return;
        currentUser = u;
        localStorage.setItem('active_session', u);
        showDashboard();
    }

    function showDashboard() {
        document.querySelectorAll('.overlay').forEach(o => o.style.display='none');
        document.getElementById('home-screen').style.display = 'flex';
        document.getElementById('global-nav').style.display = 'none';
        document.getElementById('lvl-status').innerText = `ARCHITECT: ${currentUser}`;
    }

    function prepareGame(mode) {
        currentMode = mode;
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('game-setup').style.display = 'flex';
    }

    function confirmStart() {
        document.querySelectorAll('.overlay').forEach(o => o.style.display='none');
        document.getElementById('global-nav').style.display = 'flex';
        document.getElementById('p1-label').innerText = currentUser;
        document.getElementById('p2-label').innerText = currentMode === 'bot' ? "AI CORE" : (document.getElementById('p2-input').value || "GUEST");
        game.reset(); initBoard();
    }

    function initBoard() {
        boardEl.innerHTML = '';
        for (let i = 0; i < 64; i++) {
            const r = Math.floor(i/8), c = i%8;
            const sq = document.createElement('div');
            sq.className = `sq ${(r + c) % 2 === 0 ? 'l' : 'd'}`;
            sq.dataset.id = String.fromCharCode(97 + c) + (8 - r);
            sq.onclick = () => handleInput(sq.dataset.id);
            boardEl.appendChild(sq);
        }
        render();
    }

    function handleInput(id) {
        if (selectedSq) {
            const move = game.move({ from: selectedSq, to: id, promotion: 'q' });
            if (move) {
                selectedSq = null; render();
                if (currentMode === 'bot' && !game.game_over()) {
                    setTimeout(() => {
                        const m = game.moves();
                        game.move(m[Math.floor(Math.random()*m.length)]);
                        render();
                    }, 500);
                }
                return;
            }
        }
        const p = game.get(id);
        if (p && p.color === game.turn()) {
            selectedSq = id; render();
        } else { selectedSq = null; render(); }
    }

    function render() {
        document.querySelectorAll('.sq').forEach(s => {
            const p = game.get(s.dataset.id); 
            s.innerHTML = ''; 
            s.classList.remove('selected', 'hint');
            
            // Highlight selected square
            if(s.dataset.id === selectedSq) s.classList.add('selected');

            // Show Move Hints (Dots)
            if(selectedSq) {
                const moves = game.moves({ square: selectedSq, verbose: true });
                if(moves.some(m => m.to === s.dataset.id)) s.classList.add('hint');
            }

            if (p) {
                const img = document.createElement('img');
                img.src = `https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/alpha/${p.color}${p.type.toUpperCase()}.svg`;
                img.className = 'piece' + (p.color === 'b' ? ' black' : '');
                s.appendChild(img);
            }
        });
        if(game.game_over()) alert("Game Over");
    }

    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function doLogout() { localStorage.removeItem('active_session'); location.reload(); }
    window.onload = () => { const s = localStorage.getItem('active_session'); if(s) { currentUser = s; showDashboard(); } };
</script>
</body>
</html>
