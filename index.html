<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHESS 100: THE GAUNTLET</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap');

        :root {
            --bg: #050505;
            --primary: #00ffcc;
            --sq-light: #e0e0e0;
            --sq-dark: #333;
            --glow: 0 0 20px rgba(0,255,204,0.5);
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Orbitron', sans-serif; display: flex;
            flex-direction: column; align-items: center; height: 100vh; overflow: hidden;
            transition: background 0.5s;
        }

        /* --- Level Progress --- */
        .level-header {
            width: 100%; max-width: 500px; padding: 20px;
            text-align: center; z-index: 10;
        }
        .progress-container {
            width: 100%; height: 8px; background: #222; border-radius: 4px; margin-top: 10px;
        }
        #progress-bar {
            width: 1%; height: 100%; background: var(--primary);
            box-shadow: var(--glow); transition: 0.5s;
        }

        /* --- Chess Board --- */
        #board-wrapper {
            position: relative; width: 95vw; max-width: 450px;
            aspect-ratio: 1/1; border: 4px solid var(--primary);
            box-shadow: var(--glow); transition: transform 0.1s;
        }
        #board {
            display: grid; grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr); height: 100%;
        }
        .square {
            display: flex; justify-content: center; align-items: center;
            position: relative; transition: background 0.3s;
        }
        .piece {
            width: 90%; height: 90%; z-index: 5;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
            transition: transform 0.2s;
        }
        .piece:active { transform: scale(1.2); }

        /* --- Indicators --- */
        .hint { width: 12px; height: 12px; background: var(--primary); border-radius: 50%; opacity: 0.6; }
        .last-move { background: rgba(255,255,255,0.2) !important; }
        .selected { box-shadow: inset 0 0 15px var(--primary) !important; }

        /* --- HUD --- */
        .controls {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            width: 95%; max-width: 450px; padding: 20px;
        }
        button {
            background: #111; border: 1px solid var(--primary); color: var(--primary);
            padding: 12px; border-radius: 5px; font-family: 'Orbitron'; font-weight: bold;
            cursor: pointer; transition: 0.3s;
        }
        button:hover { background: var(--primary); color: black; }

        #msg-box {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 50px; font-weight: 900; text-shadow: 0 0 30px var(--primary);
            pointer-events: none; opacity: 0; transition: 0.3s; z-index: 100;
        }

        /* --- Animations --- */
        @keyframes shake {
            0% { transform: translate(1px, 1px); }
            20% { transform: translate(-3px, 0px); }
            40% { transform: translate(3px, 2px); }
            60% { transform: translate(-3px, 1px); }
            80% { transform: translate(1px, -2px); }
            100% { transform: translate(0, 0); }
        }
        .shake { animation: shake 0.2s; }
    </style>
</head>
<body>

    <div id="msg-box">CHECKMATE</div>

    <div class="level-header">
        <div style="display:flex; justify-content: space-between;">
            <span>LEVEL <span id="lvl-num">1</span></span>
            <span id="bot-rank">BOT: ROOKIE</span>
        </div>
        <div class="progress-container"><div id="progress-bar"></div></div>
    </div>

    <div id="board-wrapper">
        <div id="board"></div>
    </div>

    <div class="controls">
        <button onclick="resetGame()">RESET</button>
        <button onclick="undo()">UNDO</button>
        <button onclick="changeLvl(1)">NEXT LVL (DEBUG)</button>
        <button onclick="togglePassPlay()" id="mode-btn">VS BOT</button>
    </div>

<script>
    const game = new Chess();
    const boardEl = document.getElementById('board');
    let level = 1;
    let selectedSq = null;
    let passPlay = false;

    const piecesImg = {
        wP: 'https://upload.wikimedia.org/wikipedia/commons/4/45/Chess_plt45.svg',
        wR: 'https://upload.wikimedia.org/wikipedia/commons/7/72/Chess_rlt45.svg',
        wN: 'https://upload.wikimedia.org/wikipedia/commons/7/70/Chess_nlt45.svg',
        wB: 'https://upload.wikimedia.org/wikipedia/commons/b/b1/Chess_blt45.svg',
        wQ: 'https://upload.wikimedia.org/wikipedia/commons/1/15/Chess_qlt45.svg',
        wK: 'https://upload.wikimedia.org/wikipedia/commons/4/42/Chess_klt45.svg',
        bP: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Chess_pdt45.svg',
        bR: 'https://upload.wikimedia.org/wikipedia/commons/f/ff/Chess_rdt45.svg',
        bN: 'https://upload.wikimedia.org/wikipedia/commons/e/ef/Chess_ndt45.svg',
        bB: 'https://upload.wikimedia.org/wikipedia/commons/9/98/Chess_bdt45.svg',
        bQ: 'https://upload.wikimedia.org/wikipedia/commons/4/47/Chess_qdt45.svg',
        bK: 'https://upload.wikimedia.org/wikipedia/commons/f/f0/Chess_kdt45.svg'
    };

    function init() {
        boardEl.innerHTML = '';
        for (let r = 0; r < 8; r++) {
            for (let c = 0; c < 8; c++) {
                const sq = document.createElement('div');
                const id = String.fromCharCode(97 + c) + (8 - r);
                sq.className = `square ${(r + c) % 2 === 0 ? 'light' : 'dark'}`;
                sq.dataset.id = id;
                sq.onclick = () => handleMove(id);
                boardEl.appendChild(sq);
            }
        }
        applyTheme();
        render();
    }

    function render() {
        const history = game.history({verbose: true});
        const lastMove = history[history.length - 1];

        document.querySelectorAll('.square').forEach(sq => {
            sq.innerHTML = '';
            sq.classList.remove('selected', 'last-move');
            const p = game.get(sq.dataset.id);
            if (p) {
                const img = document.createElement('img');
                img.src = piecesImg[p.color + p.type.toUpperCase()];
                img.className = 'piece';
                sq.appendChild(img);
            }
            if (lastMove && (sq.dataset.id === lastMove.from || sq.dataset.id === lastMove.to)) {
                sq.classList.add('last-move');
            }
        });
        checkStatus();
    }

    function handleMove(id) {
        if (!passPlay && game.turn() === 'b') return;

        if (selectedSq) {
            const move = game.move({ from: selectedSq, to: id, promotion: 'q' });
            if (move) {
                if(move.captured) triggerImpact();
                selectedSq = null;
                render();
                if (!passPlay) setTimeout(botMove, 500);
                return;
            }
        }

        const p = game.get(id);
        if (p && p.color === game.turn()) {
            selectedSq = id;
            render();
            document.querySelector(`[data-id="${id}"]`).classList.add('selected');
            game.moves({square: id, verbose: true}).forEach(m => {
                const h = document.createElement('div'); h.className = 'hint';
                document.querySelector(`[data-id="${m.to}"]`).appendChild(h);
            });
        } else {
            selectedSq = null;
            render();
        }
    }

    // --- AI BOT (Scales with Level) ---
    function botMove() {
        if (game.game_over()) return;
        
        let moves = game.moves();
        let chosenMove;

        // Level-based difficulty logic
        if (level < 20) {
            chosenMove = moves[Math.floor(Math.random() * moves.length)];
        } else {
            // Basic Material Capture AI
            let bestScore = -9999;
            moves.forEach(m => {
                game.move(m);
                let score = -evaluateBoard(game.board());
                game.undo();
                if(score > bestScore) { bestScore = score; chosenMove = m; }
            });
        }

        const mObj = game.move(chosenMove);
        if(mObj.captured) triggerImpact();
        render();
    }

    function evaluateBoard(board) {
        const vals = {p: 10, n: 30, b: 30, r: 50, q: 90, k: 900};
        let total = 0;
        board.forEach(row => row.forEach(p => {
            if(p) total += vals[p.type] * (p.color === 'w' ? 1 : -1);
        }));
        return total;
    }

    // --- CRAZY EFFECTS ---
    function applyTheme() {
        const hue = (level * 137) % 360; // Spread colors evenly
        const primary = `hsl(${hue}, 100%, 50%)`;
        document.documentElement.style.setProperty('--primary', primary);
        document.documentElement.style.setProperty('--glow', `0 0 20px hsl(${hue}, 100%, 50%, 0.5)`);
        
        const squares = document.querySelectorAll('.square');
        squares.forEach(sq => {
            if(sq.classList.contains('light')) sq.style.backgroundColor = `hsl(${hue}, 20%, 85%)`;
            else sq.style.backgroundColor = `hsl(${hue}, 40%, 20%)`;
        });

        document.getElementById('lvl-num').innerText = level;
        document.getElementById('progress-bar').style.width = level + '%';
        
        const ranks = ["ROOKIE", "NOVICE", "WARRIOR", "ELITE", "MASTER", "GRANDMASTER", "DEEP BLUE", "GOD MODE"];
        document.getElementById('bot-rank').innerText = "BOT: " + ranks[Math.floor(level/13)] || "DEITY";
    }

    function triggerImpact() {
        const wrapper = document.getElementById('board-wrapper');
        wrapper.classList.add('shake');
        setTimeout(() => wrapper.classList.remove('shake'), 200);
    }

    function flashMsg(txt) {
        const b = document.getElementById('msg-box');
        b.innerText = txt; b.style.opacity = 1;
        setTimeout(() => b.style.opacity = 0, 2000);
    }

    function checkStatus() {
        if (game.in_checkmate()) {
            flashMsg("LEVEL UP!");
            if(game.turn() === 'b') changeLvl(1); // Player won
        } else if (game.in_draw()) {
            flashMsg("STALEMATE");
        }
    }

    function changeLvl(n) {
        level = Math.min(100, level + n);
        game.reset();
        init();
    }

    function togglePassPlay() {
        passPlay = !passPlay;
        document.getElementById('mode-btn').innerText = passPlay ? "PASS & PLAY" : "VS BOT";
        resetGame();
    }

    function resetGame() { game.reset(); render(); }
    function undo() { game.undo(); if(!passPlay) game.undo(); render(); }

    init();
</script>
</body>
</html>
