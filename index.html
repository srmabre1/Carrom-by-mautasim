<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Carrom Mobile</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #000; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #game-container { position: relative; border: 12px solid #3e2723; border-radius: 15px; box-shadow: 0 0 40px #000; }
        #ui { position: absolute; top: -50px; width: 100%; display: flex; justify-content: space-between; color: gold; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui">
        <span>PLAYER 1</span>
        <span id="score">SCORE: 0</span>
    </div>
</div>

<script>
const config = {
    type: Phaser.AUTO,
    parent: 'game-container',
    width: 600,
    height: 600,
    backgroundColor: '#dfbb85',
    physics: {
        default: 'arcade',
        arcade: { friction: 0.1, debug: false }
    },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let striker, coins, pockets, score = 0;
let isAiming = false, startPos = {}, graphics, sliderLine;

function preload() {}

function create() {
    let g = this.make.graphics();
    
    // Create 3D Looking Striker
    g.fillStyle(0x1a237e).fillCircle(20, 20, 20);
    g.lineStyle(3, 0xffffff, 0.3).strokeCircle(20, 20, 16);
    g.generateTexture('striker', 40, 40);

    // Create 3D Looking White Coin
    g.clear().fillStyle(0xffffff).fillCircle(15, 15, 15);
    g.lineStyle(2, 0xdddddd).strokeCircle(15, 15, 12);
    g.generateTexture('white', 30, 30);

    // Create 3D Looking Black Coin
    g.clear().fillStyle(0x212121).fillCircle(15, 15, 15);
    g.lineStyle(2, 0x444444).strokeCircle(15, 15, 12);
    g.generateTexture('black', 30, 30);

    // Queen
    g.clear().fillStyle(0xd81b60).fillCircle(15, 15, 15);
    g.lineStyle(2, 0xffffff, 0.4).strokeCircle(15, 15, 12);
    g.generateTexture('queen', 30, 30);

    // Board Markings
    let boardG = this.add.graphics();
    boardG.lineStyle(2, 0x3e2723, 0.5);
    boardG.strokeCircle(300, 300, 75); // Center Circle
    boardG.strokeRect(100, 100, 400, 400); // Inner Box
    // Striker Lines
    boardG.lineStyle(4, 0x3e2723, 0.3);
    boardG.lineBetween(120, 480, 480, 480);
    boardG.lineBetween(120, 495, 480, 495);

    pockets = this.physics.add.staticGroup();
    const pPos = [35, 565];
    pPos.forEach(x => pPos.forEach(y => pockets.create(x, y, null).setSize(50, 50).setVisible(false)));

    coins = this.physics.add.group({ bounceX: 0.7, bounceY: 0.7, dragX: 0.985, dragY: 0.985, useDamping: true });
    
    // Setup Coins in Hexagon
    createCoin(this, 300, 300, 'queen');
    for(let i=0; i<6; i++) {
        let angle = i * (Math.PI/3);
        createCoin(this, 300 + Math.cos(angle)*35, 300 + Math.sin(angle)*35, 'white');
        createCoin(this, 300 + Math.cos(angle+0.5)*65, 300 + Math.sin(angle+0.5)*65, 'black');
    }

    striker = this.physics.add.image(300, 487, 'striker').setCircle(20).setCollideWorldBounds(true).setBounce(0.5).setDamping(true).setDrag(0.98);
    striker.setInteractive({ draggable: true });

    this.physics.add.collider(striker, coins);
    this.physics.add.collider(coins, coins);
    this.physics.add.overlap(coins, pockets, (c) => { c.destroy(); score += 10; document.getElementById('score').innerText = "SCORE: " + score; });

    graphics = this.add.graphics();

    // Shooting Logic
    this.input.on('pointerdown', (p) => {
        if (striker.body.speed < 2) {
            if (p.y > 450) { // Position Mode
                striker.x = Phaser.Math.Clamp(p.x, 120, 480);
            } else { // Aim Mode
                isAiming = true;
                startPos = { x: p.x, y: p.y };
            }
        }
    });

    this.input.on('pointermove', (p) => {
        if (isAiming) {
            graphics.clear().lineStyle(2, 0xffffff, 0.5).lineBetween(striker.x, striker.y, striker.x + (startPos.x - p.x), striker.y + (startPos.y - p.y));
        }
    });

    this.input.on('pointerup', (p) => {
        if (isAiming) {
            graphics.clear();
            striker.setVelocity((startPos.x - p.x) * 5, (startPos.y - p.y) * 5);
            isAiming = false;
        }
    });
}

function createCoin(scene, x, y, key) {
    let c = coins.create(x, y, key);
    c.setCircle(15).setCollideWorldBounds(true);
}

function update() {
    if (striker.body.speed < 5 && striker.body.speed > 0) {
        striker.setVelocity(0);
        striker.y = 487; // Reset to line
    }
}
</script>
</body>
</html>
