<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Architect Chess: Pro Edition</title>
    
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <style>
        :root { --bg: #f4f7f6; --card: #ffffff; --text: #2d3436; --accent: #0984e3; }
        body.dark-mode { --bg: #1e272e; --card: #2f3640; --text: #f5f6fa; --accent: #00a8ff; }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; transition: 0.3s; }
        
        /* Login Overlay */
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; }
        .auth-box { background:var(--card); padding:30px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.1); display:flex; flex-direction:column; gap:10px; width:80%; max-width:300px; }
        input { padding:12px; border-radius:8px; border:1px solid #ddd; }
        
        .nav { width: 100%; padding: 15px; display: flex; justify-content: space-between; align-items: center; background: var(--card); box-shadow: 0 2px 10px rgba(0,0,0,0.1); box-sizing: border-box; }
        .scoreboard { display: flex; gap: 20px; margin: 15px 0; background: var(--card); padding: 10px 25px; border-radius: 50px; font-weight: bold; }
        #board { width: 95vw; max-width: 380px; border-radius: 5px; }
        .controls { margin: 15px; padding: 15px; background: var(--card); width: 85vw; max-width: 380px; border-radius: 12px; text-align: center; }
        .btn { padding: 10px 15px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin: 5px; }
        .btn-main { background: var(--accent); color: white; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="light-mode">

    <div id="login-screen">
        <h2>ARCHITECT LOGIN</h2>
        <div class="auth-box">
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="pass" placeholder="Password">
            <button class="btn btn-main" onclick="handleLogin()">LOGIN</button>
            <button class="btn" style="background:#55efc4" onclick="handleSignUp()">SIGN UP</button>
        </div>
    </div>

    <div class="nav">
        <span id="display-name" style="font-weight: 900;">ARCHITECT</span>
        <button class="btn" style="background:#b2bec3" onclick="toggleTheme()" id="theme-btn">ðŸŒ™ Dark</button>
    </div>

    <div class="scoreboard">
        <div>ðŸ‘¤ <span id="p-name">You</span>: <span id="p-score">0</span></div>
        <div>ðŸ¤– AI: <span id="ai-score">0</span></div>
    </div>

    <div id="board"></div>

    <div class="controls">
        <div id="status-text" style="margin-bottom:10px; font-weight:bold; color:var(--accent);">Ready to play</div>
        <button class="btn btn-main" onclick="resetGame()">New AI Game</button>
        <button class="btn" style="background:#fab1a0" onclick="undoMove()">Undo</button>
        <button class="btn" style="background:#a29bfe" onclick="startOnline()">Online P2P</button>
        <button class="btn" style="background:#ff7675; color:white;" onclick="auth.signOut()">Logout</button>
    </div>

    <script>
        // --- 1. FIREBASE CONFIG (PASTE YOUR KEYS HERE) ---
        const firebaseConfig = {
            apiKey: "PASTE_HERE",
            authDomain: "PASTE_HERE",
            projectId: "PASTE_HERE",
            storageBucket: "PASTE_HERE",
            messagingSenderId: "PASTE_HERE",
            appId: "PASTE_HERE"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // --- 2. STATE & UI ---
        let board = null, game = new Chess(), peer = null, conn = null;
        let pScore = parseInt(localStorage.getItem('pScore')) || 0;
        let aiScore = parseInt(localStorage.getItem('aiScore')) || 0;
        let playerName = "Architect";

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            $('#theme-btn').text(document.body.classList.contains('dark-mode') ? "â˜€ï¸ Light" : "ðŸŒ™ Dark");
        }

        // --- 3. AUTH LOGIC ---
        function handleLogin() {
            auth.signInWithEmailAndPassword($('#email').val(), $('#pass').val()).catch(e => alert(e.message));
        }
        function handleSignUp() {
            auth.createUserWithEmailAndPassword($('#email').val(), $('#pass').val()).catch(e => alert(e.message));
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                playerName = user.email.split('@')[0].toUpperCase();
                $('#display-name, #p-name').text(playerName);
                $('#login-screen').addClass('hidden');
                updateScoreDisplay();
            } else {
                $('#login-screen').removeClass('hidden');
            }
        });

        // --- 4. GAME LOGIC ---
        function onDragStart(s, piece) {
            if (game.game_over() || piece.search(/^b/) !== -1) return false;
        }

        function onDrop(source, target) {
            let move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';
            
            if (conn) conn.send(game.fen());
            else window.setTimeout(makeAiMove, 500);
            updateStatus();
        }

        function makeAiMove() {
            let moves = game.moves();
            if (moves.length > 0) {
                game.move(moves[Math.floor(Math.random() * moves.length)]);
                board.position(game.fen());
                updateStatus();
            }
        }

        function updateStatus() {
            if (game.in_checkmate()) {
                if (game.turn() === 'b') { pScore++; localStorage.setItem('pScore', pScore); alert("ðŸ† " + playerName + " WINS!"); }
                else { aiScore++; localStorage.setItem('aiScore', aiScore); alert("ðŸ¤– AI WINS!"); }
            }
            $('#p-score').text(pScore); $('#ai-score').text(aiScore);
            $('#status-text').text(game.turn() === 'w' ? "Your Move" : "Thinking...");
        }

        function updateScoreDisplay() { $('#p-score').text(pScore); $('#ai-score').text(aiScore); }

        function resetGame() { game.reset(); board.start(); updateStatus(); }
        function undoMove() { game.undo(); game.undo(); board.position(game.fen()); }

        // --- 5. ONLINE P2P ---
        function startOnline() {
            let friendId = prompt("Enter Friend's ID to Join (Leave blank to Host):");
            peer = new Peer();
            peer.on('open', id => {
                if (!friendId) alert("SHARE THIS ID: " + id);
                else { conn = peer.connect(friendId); setupConn(); }
            });
            peer.on('connection', c => { conn = c; setupConn(); });
        }
        function setupConn() {
            conn.on('data', data => { game.load(data); board.position(game.fen()); updateStatus(); });
            alert("CONNECTED TO OPPONENT!");
        }

        board = Chessboard('board', { draggable: true, position: 'start', onDragStart: onDragStart, onDrop: onDrop, onSnapEnd: () => board.position(game.fen()) });
    </script>
</body>
</html>
