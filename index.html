<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mautasim Royal Carrom Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #0a0a0a; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        #game-wrapper { position: relative; border: 22px solid #4E342E; border-radius: 12px; box-shadow: 0 0 80px #000; }
        #ui { position: absolute; top: -75px; width: 100%; display: flex; justify-content: space-around; color: #fff; }
        .p-box { padding: 8px 16px; border-radius: 6px; background: #222; border: 1px solid #4E342E; transition: 0.3s; font-size: 14px; letter-spacing: 1px; }
        .active { background: #d32f2f; color: #fff; border: 2px solid #fff; transform: scale(1.1); box-shadow: 0 0 15px #d32f2f; }
        #win-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: gold; }
        #restart-btn { margin-top: 20px; padding: 12px 40px; background: #d32f2f; color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="ui">
        <div id="p1-ui" class="p-box active">PLAYER 1: 0</div>
        <div id="p2-ui" class="p-box">PLAYER 2: 0</div>
        <div id="p3-ui" class="p-box">PLAYER 3: 0</div>
        <div id="p4-ui" class="p-box">PLAYER 4: 0</div>
    </div>
    <div id="win-screen">
        <h1 id="win-title">MAUTASIM IS THE CHAMPION!</h1>
        <button id="restart-btn" onclick="location.reload()">NEW GAME</button>
    </div>
</div>

<script>
const GAME_SIZE = 800;
const CENTER = GAME_SIZE / 2;

const config = {
    type: Phaser.AUTO,
    parent: 'game-wrapper',
    width: GAME_SIZE,
    height: GAME_SIZE,
    backgroundColor: '#F5DEB3',
    physics: { default: 'arcade', arcade: { friction: 0.1, debug: false } },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let striker, coins, pockets, graphics, isAiming = false, startPos = {}, currentPlayer = 1;
let scores = { 1: 0, 2: 0, 3: 0, 4: 0 }, waitingForStop = false;

function preload() {}

function create() {
    let boardG = this.add.graphics();
    
    // 1. Realistic Pockets
    boardG.fillStyle(0x111111).fillCircle(45, 45, 42).fillCircle(755, 45, 42).fillCircle(45, 755, 42).fillCircle(755, 755, 42);

    // 2. High-Fidelity Design (Matching your Vector Image)
    const drawPillar = (x, y, w, h, isVert) => {
        boardG.lineStyle(3, 0x3e2723, 1).strokeRoundedRect(x, y, w, h, 20);
        boardG.fillStyle(0xd32f2f, 1);
        if(!isVert) {
            boardG.fillCircle(x+20, y+h/2, 14).strokeCircle(x+20, y+h/2, 14);
            boardG.fillCircle(x+w-20, y+h/2, 14).strokeCircle(x+w-20, y+h/2, 14);
        } else {
            boardG.fillCircle(x+w/2, y+20, 14).strokeCircle(x+w/2, y+20, 14);
            boardG.fillCircle(x+w/2, y+h-20, 14).strokeCircle(x+w/2, y+h-20, 14);
        }
    };
    
    // Baselines
    drawPillar(155, 155, 490, 42, false); // Top
    drawPillar(155, 603, 490, 42, false); // Bottom
    drawPillar(155, 155, 42, 490, true);  // Left
    drawPillar(603, 155, 42, 490, true);  // Right

    // Diagonal Lines & Curved Arrows
    boardG.lineStyle(2, 0x3e2723, 0.8);
    [[110,110,180,180], [690,110,620,180], [110,690,180,620], [690,690,620,620]].forEach(l => boardG.lineBetween(l[0],l[1],l[2],l[3]));

    // 3. Central Master Design
    boardG.lineStyle(2, 0x000000).strokeCircle(CENTER, CENTER, 95);
    boardG.lineStyle(8, 0xd32f2f).strokeCircle(CENTER, CENTER, 85);
    boardG.lineStyle(2, 0x000000).strokeCircle(CENTER, CENTER, 75);

    // 4. Custom Branding
    const ts = { fontFamily: 'Impact', fontSize: '32px', color: '#5D4037', alpha: 0.4 };
    this.add.text(CENTER, 770, 'MAUTASIM', ts).setOrigin(0.5);
    this.add.text(CENTER, 30, 'MAUTASIM', ts).setOrigin(0.5).setAngle(180);
    this.add.text(30, CENTER, 'MAUTASIM', ts).setOrigin(0.5).setAngle(-90);
    this.add.text(770, CENTER, 'MAUTASIM', ts).setOrigin(0.5).setAngle(90);

    // 5. Game Assets
    let tex = this.make.graphics();
    tex.fillStyle(0xffeb3b).fillCircle(25,25,25).lineStyle(3,0xfbc02d).strokeCircle(25,25,23).generateTexture('striker',50,50);
    tex.clear().fillStyle(0xffffff).fillCircle(18,18,18).lineStyle(2,0x8d6e63).strokeCircle(18,18,16).generateTexture('white',36,36);
    tex.clear().fillStyle(0x222222).fillCircle(18,18,18).lineStyle(2,0x000000).strokeCircle(18,18,16).generateTexture('black',36,36);
    tex.clear().fillStyle(0xd32f2f).fillCircle(18,18,18).lineStyle(2,0xffffff).strokeCircle(18,18,16).generateTexture('queen',36,36);

    pockets = this.physics.add.staticGroup();
    [[45,45],[755,45],[45,755],[755,755]].forEach(p => pockets.create(p[0],p[1],null).setSize(65,65).setVisible(false));

    coins = this.physics.add.group({ bounceX: 0.7, bounceY: 0.7, dragX: 0.99, dragY: 0.99, useDamping: true });
    createCoin(this, CENTER, CENTER, 'queen');
    for(let i=0; i<6; i++){
        let a = i*(Math.PI/3);
        createCoin(this, CENTER+Math.cos(a)*39, CENTER+Math.sin(a)*39, 'white');
        createCoin(this, CENTER+Math.cos(a+0.5)*76, CENTER+Math.sin(a+0.5)*76, 'black');
    }

    striker = this.physics.add.image(CENTER, 624, 'striker').setCircle(25).setCollideWorldBounds(true).setDamping(true).setDrag(0.982).setBounce(0.5);
    
    this.physics.add.collider(striker, coins);
    this.physics.add.collider(coins, coins);
    
    this.physics.add.overlap(coins, pockets, (c) => { 
        let points = (c.texture.key === 'queen') ? 50 : 20;
        scores[currentPlayer] += points; 
        updateScoreboard();
        c.destroy(); 
        checkWin(); 
    });
    
    this.physics.add.overlap(striker, pockets, () => { 
        scores[currentPlayer] = Math.max(0, scores[currentPlayer] - 10);
        updateScoreboard();
        striker.setVelocity(0); 
    });

    graphics = this.add.graphics();

    this.input.on('pointerdown', (p) => {
        if(!waitingForStop) {
            if(isLineTouch(p)) { moveStriker(p.x, p.y); }
            else { isAiming = true; startPos = {x:p.x, y:p.y}; }
        }
    });

    this.input.on('pointermove', (p) => { 
        if(isAiming) { 
            graphics.clear().lineStyle(4,0xd32f2f,0.6).lineBetween(striker.x, striker.y, striker.x+(startPos.x-p.x), striker.y+(startPos.y-p.y)); 
        }
    });

    this.input.on('pointerup', (p) => { 
        if(isAiming) { 
            graphics.clear(); 
            let forceX = (startPos.x - p.x) * 6.5;
            let forceY = (startPos.y - p.y) * 6.5;
            striker.setVelocity(forceX, forceY); 
            isAiming = false; 
            waitingForStop = true; 
        }
    });
}

function isLineTouch(p) {
    if(currentPlayer===1 && p.y > 580) return true;
    if(currentPlayer===3 && p.y < 220) return true;
    if(currentPlayer===2 && p.x < 220) return true;
    if(currentPlayer===4 && p.x > 580) return true;
    return false;
}

function moveStriker(x, y) {
    let min = 175, max = 625;
    if(currentPlayer===1) striker.setPosition(Phaser.Math.Clamp(x, min, max), 624);
    else if(currentPlayer===2) striker.setPosition(176, Phaser.Math.Clamp(y, min, max));
    else if(currentPlayer===3) striker.setPosition(Phaser.Math.Clamp(x, min, max), 176);
    else if(currentPlayer===4) striker.setPosition(624, Phaser.Math.Clamp(y, min, max));
}

function update() {
    if(waitingForStop) {
        let moving = striker.body.speed > 5;
        coins.children.iterate(c => { if(c.body.speed > 5) moving = true; });
        if(!moving) { waitingForStop = false; nextPlayer(); }
    }
}

function nextPlayer() {
    document.querySelectorAll('.p-box').forEach(b => b.classList.remove('active'));
    currentPlayer = (currentPlayer % 4) + 1;
    document.getElementById(`p${currentPlayer}-ui`).classList.add('active');
    striker.setVelocity(0);
    if(currentPlayer===1) striker.setPosition(CENTER, 624);
    if(currentPlayer===2) striker.setPosition(176, CENTER);
    if(currentPlayer===3) striker.setPosition(CENTER, 176);
    if(currentPlayer===4) striker.setPosition(624, CENTER);
}

function updateScoreboard() {
    for(let i=1; i<=4; i++) {
        document.getElementById(`p${i}-ui`).innerText = `PLAYER ${i}: ${scores[i]}`;
    }
}

function createCoin(s, x, y, k) { s.physics.add.existing(coins.create(x, y, k).setCircle(18).setCollideWorldBounds(true).setBounce(0.6)); }

function checkWin() {
    if(coins.countActive() === 0) { document.getElementById('win-screen').style.display = 'flex'; }
}
</script>
</body>
</html>
