<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARCHITECT CHESS PRO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Roboto+Mono&display=swap');
        :root { --p: #00d4ff; --bg: #050a12; --c: rgba(20, 27, 38, 0.8); --sl: #dee3e6; --sd: #769656; --danger: #ff4b2b; }
        
        body { margin: 0; background: radial-gradient(circle at center, #0a192f 0%, #02060c 100%); color: white; font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        
        /* Piece Styling */
        img.piece { width: 85%; z-index: 5; pointer-events: none; transition: transform 0.2s; }
        .sq:active img.piece { transform: scale(1.1); }

        /* UI Elements */
        .architect-tag { font-size: 26px; font-weight: 900; color: var(--p); text-shadow: 0 0 20px var(--p); letter-spacing: 4px; margin: 15px 0 2px 0; }
        .dev-tag { font-size: 9px; color: #444; letter-spacing: 3px; margin-bottom: 15px; }
        
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .glass-card { background: var(--c); padding: 25px; border-radius: 24px; width: 85%; max-width: 320px; border: 1px solid rgba(0, 212, 255, 0.2); text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        
        input { background: rgba(0,0,0,0.5); border: 1px solid #333; color: white; padding: 14px; margin: 8px 0; width: 100%; text-align: center; border-radius: 12px; font-family: 'Roboto Mono'; outline: none; box-sizing: border-box; transition: 0.3s; }
        input:focus { border-color: var(--p); box-shadow: 0 0 10px var(--p); }
        
        .btn-main { width: 100%; padding: 15px; background: var(--p); color: #000; border: none; border-radius: 12px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4); }

        /* Board Styling */
        #board-box { margin: 10px 0; width: 94vw; max-width: 390px; aspect-ratio: 1/1; border: 8px solid #141b26; border-radius: 8px; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        #board { display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr); height: 100%; }
        .sq { display: flex; justify-content: center; align-items: center; position: relative; transition: 0.2s; }
        .sq.l { background: var(--sl); } .sq.d { background: var(--sd); }
        
        /* Indicators */
        .selected { background: rgba(0, 212, 255, 0.4) !important; box-shadow: inset 0 0 15px var(--p); }
        .move-dot { width: 14px; height: 14px; background: rgba(255,255,255,0.5); border-radius: 50%; pointer-events: none; }
        .kill-zone { background: rgba(255, 75, 43, 0.6) !important; box-shadow: inset 0 0 20px var(--danger); animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        /* HUD */
        .hud { width: 100%; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(20,27,38,0.9); border-bottom: 2px solid var(--p); box-sizing: border-box; }
        .p-name { font-family: 'Orbitron'; font-size: 11px; color: var(--p); text-transform: uppercase; }
        
        /* History & XP */
        #history-box { width: 90%; height: 120px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 12px; margin-top: 10px; padding: 10px; border: 1px solid #222; }
        .h-row { display: flex; justify-content: space-between; font-size: 10px; padding: 5px; border-bottom: 1px solid #111; font-family: 'Roboto Mono'; }
        .xp-cont { width: 80%; height: 6px; background: #111; border-radius: 10px; margin: 10px; position: relative; overflow: hidden; }
        .xp-bar { height: 100%; background: var(--p); width: 0%; transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
    </style>
</head>
<body onclick="initAudio()">

    <div id="auth-screen" class="overlay">
        <div class="architect-tag">ARCHITECT PRO</div>
        <div class="dev-tag">DESIGNED BY MAUTASIM</div>
        <div class="glass-card">
            <h2 style="font-size:12px; margin-bottom:20px;">SYSTEM INITIALIZATION</h2>
            <input type="text" id="user-in" placeholder="ACCESS IDENTITY">
            <input type="password" id="pass-in" placeholder="SECURITY KEY">
            <button class="btn-main" onclick="handleAuth()">LOGIN</button>
            <p style="font-size: 9px; color: #666; margin-top: 15px; cursor:pointer" onclick="toggleAuth()">+ CREATE NEW ARCHITECT ID</p>
        </div>
    </div>

    <div id="home-screen" class="overlay" style="display:none">
        <div class="architect-tag">ARCHITECT</div>
        <div id="lvl-txt" style="font-size: 10px; color: var(--p);">LVL 1</div>
        <div class="xp-cont"><div id="xp-bar" class="xp-bar"></div></div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; width:85%; margin-top:15px;">
            <div onclick="prepareGame('bot')" class="glass-card" style="padding:15px; cursor:pointer; font-size:10px;">ULTRA AI</div>
            <div onclick="prepareGame('pass')" class="glass-card" style="padding:15px; cursor:pointer; font-size:10px;">LOCAL PASS</div>
            <div onclick="prepareGame('online')" class="glass-card" style="padding:15px; cursor:pointer; font-size:10px;">ONLINE</div>
            <div onclick="doLogout()" class="glass-card" style="padding:15px; cursor:pointer; font-size:10px; color:#ff4b2b;">LOGOUT</div>
        </div>

        <p style="font-size: 9px; color: #444; margin-top:20px;">MISSION LOG (LAST 20)</p>
        <div id="history-box"></div>
    </div>

    <div id="game-setup" class="overlay" style="display:none">
        <div class="glass-card">
            <h3 style="font-size:12px;">BATTLE CONFIG</h3>
            <div id="local-in" style="display:none">
                <input type="text" id="p1-n" placeholder="WHITE COMMANDER">
                <input type="text" id="p2-n" placeholder="BLACK COMMANDER">
            </div>
            <p style="font-size: 9px; color: var(--p); margin: 15px 0 5px 0;">SELECT BOARD THEME</p>
            <div style="display:flex; gap:10px; justify-content:center; margin-bottom:20px;">
                <div onclick="setTheme('neon')" style="width:40px;height:40px;background:#00d4ff;border-radius:8px;"></div>
                <div onclick="setTheme('classic')" style="width:40px;height:40px;background:#769656;border-radius:8px;"></div>
                <div onclick="setTheme('wood')" style="width:40px;height:40px;background:#b58863;border-radius:8px;"></div>
            </div>
            <button class="btn-main" onclick="confirmStart()">ENGAGE</button>
        </div>
    </div>

    <div class="hud">
        <div class="p-name" id="p1-label">---</div>
        <div style="color:var(--p); font-weight:900;">VS</div>
        <div class="p-name" id="p2-label" style="text-align:right">---</div>
    </div>

    <div id="board-box"><div id="board"></div></div>

    <div id="win-screen" class="overlay" style="display:none">
        <div class="glass-card">
            <h1 id="win-txt" style="color:var(--p); font-size:20px;">VICTORY</h1>
            <p id="xp-msg" style="font-size:12px; margin-bottom:20px;"></p>
            <button class="btn-main" onclick="showDashboard()">CONTINUE</button>
        </div>
    </div>

<script>
    const game = new Chess();
    const boardEl = document.getElementById('board');
    let currentUser = null, vsBot = true, isOnline = false, isPass = false, myColor = 'w', selectedSq = null, audioCtx = null, authMode = 'login', curMode = 'bot';

    const themes = {
        neon: { sl: '#1a1a1a', sd: '#00d4ff' },
        classic: { sl: '#dee3e6', sd: '#769656' },
        wood: { sl: '#f0d9b5', sd: '#b58863' }
    };

    function setTheme(t) {
        document.documentElement.style.setProperty('--sl', themes[t].sl);
        document.documentElement.style.setProperty('--sd', themes[t].sd);
    }

    function saveMatch(opp, res) {
        let history = JSON.parse(localStorage.getItem(`h_${currentUser}`)) || [];
        history.unshift({ opp, res, date: new Date().toLocaleDateString() });
        if(history.length > 20) history.pop();
        localStorage.setItem(`h_${currentUser}`, JSON.stringify(history));
    }

    function loadHistory() {
        const box = document.getElementById('history-box');
        box.innerHTML = '';
        let history = JSON.parse(localStorage.getItem(`h_${currentUser}`)) || [];
        history.forEach(m => {
            box.innerHTML += `<div class="h-row"><span>${m.date} vs ${m.opp}</span><span style="color:${m.res==='WIN'?'#00ff00':'#ff4b2b'}">${m.res}</span></div>`;
        });
    }

    function prepareGame(mode) {
        curMode = mode;
        document.getElementById('home-screen').style.display='none';
        document.getElementById('game-setup').style.display='flex';
        document.getElementById('local-in').style.display = (mode==='pass')?'block':'none';
    }

    function confirmStart() {
        vsBot=(curMode==='bot'); isPass=(curMode==='pass'); isOnline=(curMode==='online');
        document.getElementById('game-setup').style.display='none';
        document.getElementById('p1-label').innerText = isPass ? (document.getElementById('p1-n').value || "ARCHITECT") : currentUser;
        document.getElementById('p2-label').innerText = vsBot ? "ULTRA AI" : "GUEST";
        game.reset(); initBoard();
    }

    function initBoard() {
        boardEl.innerHTML = '';
        for (let i = 0; i < 64; i++) {
            const r = Math.floor(i/8), c = i%8;
            const sq = document.createElement('div');
            sq.className = `sq ${(r + c) % 2 === 0 ? 'l' : 'd'}`;
            sq.dataset.id = String.fromCharCode(97 + c) + (8 - r);
            sq.onclick = () => handleInput(sq.dataset.id);
            boardEl.appendChild(sq);
        }
        render();
    }

    function handleInput(id) {
        if (selectedSq) {
            const move = game.move({ from: selectedSq, to: id, promotion: 'q' });
            if (move) {
                selectedSq = null; render();
                if (vsBot && !game.game_over()) setTimeout(() => {
                    const moves = game.moves();
                    game.move(moves[Math.floor(Math.random()*moves.length)]);
                    render();
                }, 400);
                return;
            }
        }
        
        const piece = game.get(id);
        if (piece && piece.color === game.turn()) {
            selectedSq = id;
            render();
            // Highlight moves and kills
            document.querySelector(`[data-id="${id}"]`).classList.add('selected');
            game.moves({ square: id, verbose: true }).forEach(m => {
                const target = document.querySelector(`[data-id="${m.to}"]`);
                if (game.get(m.to)) target.classList.add('kill-zone'); // EATABLE PIECE TURNS RED
                else {
                    const dot = document.createElement('div');
                    dot.className = 'move-dot';
                    target.appendChild(dot);
                }
            });
        } else {
            selectedSq = null; render();
        }
    }

    function render() {
        document.querySelectorAll('.sq').forEach(s => {
            const p = game.get(s.dataset.id); s.innerHTML = ''; 
            s.classList.remove('selected', 'kill-zone');
            if (p) {
                const img = document.createElement('img');
                img.src = `https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/alpha/${p.color}${p.type.toUpperCase()}.svg`;
                img.className = 'piece'; s.appendChild(img);
            }
        });

        if (game.game_over()) {
            const win = game.in_checkmate();
            const winnerName = (game.turn() === 'b') ? document.getElementById('p1-label').innerText : document.getElementById('p2-label').innerText;
            document.getElementById('win-txt').innerText = win ? winnerName + " WINS!" : "STALEMATE";
            saveMatch(document.getElementById('p2-label').innerText, win?"WIN":"DRAW");
            document.getElementById('win-screen').style.display='flex';
        }
    }

    function handleAuth() {
        const u = document.getElementById('user-in').value.trim();
        const p = document.getElementById('pass-in').value.trim();
        if(!u) return;
        if(authMode === 'signup') {
            localStorage.setItem('pw_'+u, p);
            toggleAuth();
        } else {
            if(localStorage.getItem('pw_'+u) === p) {
                currentUser = u;
                showDashboard();
            } else alert("Access Denied");
        }
    }

    function showDashboard() {
        document.querySelectorAll('.overlay').forEach(o=>o.style.display='none');
        document.getElementById('home-screen').style.display='flex';
        let lvl = localStorage.getItem('lvl_'+currentUser) || 1;
        document.getElementById('lvl-txt').innerText = "ARCHITECT LEVEL " + lvl;
        loadHistory();
    }

    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function toggleAuth() { authMode = (authMode==='login')?'signup':'login'; }
    function doLogout() { location.reload(); }
    window.onload = () => { setTheme('neon'); };
</script>
</body>
</html>
